<html>
  <head>
    <title>SFB</title>
    <link rel=icon href="sprites/favicon.ico" sizes="16x16" type="image/vnd.microsoft.icon">
    <link rel="stylesheet" href="css/sfb.css" charset="utf-8">
  </head>
  <body>
    <div id="gameArea">
      <canvas id="sfb-game"></canvas>
    </div>


    <section class="game-menu">
        <section class="player-number-selection">
          <button id="start-game-test">Start Testing Game</button>

          <h1>How many players?</h1>
          <ul>
            <li class="player-number" data-id="1">ONE</li>
            <li class="player-number" data-id="2">TWO</li>
            <li class="player-number" data-id="3">THREE</li>
            <li class="player-number" data-id="4">FOUR</li>
          </ul>
        </section>

        <section class="game-form hidden">
          <button class="toggle-players">Change Player Number</button>
          <h3>Choose player settings and ready up!</h3>
          <ul class="player-forms group">
            <article class="player-1 group">
              <h1>PLAYER ONE</h1>
              <ul class="player-1-types" id="types">
                <h4>Select Player Type</h4>
                <li class="player-type" data-id="1" data-type="Normal">Average Speed and Strength</li>
                <li class="player-type" data-id="1" data-type="Fast">Faster but Weaker</li>
                <li class="player-type" data-id="1" data-type="Slow">Stronger but Slower</li>
              </ul>
              <ul class="player-1-farts" id="farts">
                <h4>Select Special Fart</h4>
                <li class="player-fart" data-id="1" data-type="Bounce">Bouncing</li>
                <li class="player-fart" data-id="1" data-type="Mine">Mines</li>
                <li class="player-fart" data-id="1" data-type="Flame">Flame</li>
              </ul>
              <button name="ready-up" data-id="1" class="hide-button">Ready Up!</button>
            </article>
            <article class="player-2 group">
              <h1>PLAYER TWO</h1>
              <ul class="player-2-types" id="types">
                <h4>Select Player Type</h4>
                <li class="player-type" data-id="2" data-type="Normal">Average Speed and Strength</li>
                <li class="player-type" data-id="2" data-type="Fast">Faster but Weaker</li>
                <li class="player-type" data-id="2" data-type="Slow">Stronger but Slower</li>
              </ul>
              <ul class="player-2-farts" id="farts">
                <h4>Select Special Fart</h4>
                <li class="player-fart" data-id="2" data-type="Bounce">Bouncing</li>
                <li class="player-fart" data-id="2" data-type="Mine">Mine</li>
                <li class="player-fart" data-id="2" data-type="Flame">Flame</li>
              </ul>
              <button name="ready-up" data-id="2" class="hide-button">Ready Up!</button>
            </article>
            <article class="player-3 group">
              <h1>PLAYER THREE</h1>
              <ul class="player-3-types" id="types">
                <h4>Select Player Type</h4>
                <li class="player-type" data-id="3" data-type="Normal">Average Speed and Strength</li>
                <li class="player-type" data-id="3" data-type="Fast">Faster but Weaker</li>
                <li class="player-type" data-id="3" data-type="Slow">Stronger but Slower</li>
              </ul>
              <ul class="player-3-farts" id="farts">
                <h4>Select Special Fart</h4>
                <li class="player-fart" data-id="3" data-type="Bounce">Bouncing</li>
                <li class="player-fart" data-id="3" data-type="Mine">Mine</li>
                <li class="player-fart" data-id="3" data-type="Flame">Flame</li>
              </ul>
              <button name="ready-up" data-id="3" class="hide-button">Ready Up!</button>
            </article>
            <article class="player-4 group">
              <h1>PLAYER FOUR</h1>
              <ul class="player-4-types" id="types">
                <h4>Select Player Type</h4>
                <li class="player-type" data-id="4" data-type="Normal">Average Speed and Strength</li>
                <li class="player-type" data-id="4" data-type="Fast">Faster but Weaker</li>
                <li class="player-type" data-id="4" data-type="Slow">Stronger but Slower</li>
              </ul>
              <ul class="player-4-farts" id="farts">
                <h4>Select Special Fart</h4>
                <li class="player-fart" data-id="4" data-type="Bounce">Bouncing</li>
                <li class="player-fart" data-id="4" data-type="Mine">Mine</li>
                <li class="player-fart" data-id="4" data-type="Flame">Flame</li>
              </ul>
              <button name="ready-up" data-id="4" class="hide-button">Ready Up!</button>
            </article>
          </ul>
        <button name="start-game" class="hide-button">Start Game</button>
      </section>
    </section>



    <script src="vendor/jquery-2.1.1.js"></script>
    <script type="application/javascript" src="vendor/keymaster.js"></script>

    <script type="application/javascript" src="lib/utils.js"></script>
    <script type="application/javascript" src="lib/gameObject.js"></script>
    <script type="application/javascript" src="lib/staticObject.js"></script>

    <script type="application/javascript" src="lib/animation.js"></script>
    <script type="application/javascript" src="lib/spriteSheet.js"></script>
    <script type="application/javascript" src="lib/movingObject.js"></script>
    <script type="application/javascript" src="lib/spriteGameObject.js"></script>
    <script type="application/javascript" src="lib/animatedObject.js"></script>
    <script type="application/javascript" src="lib/gnome.js"></script>
    <script type="application/javascript" src="lib/scene.js"></script>
    <script type="application/javascript" src="lib/fart.js"></script>
    <script type="application/javascript" src="lib/fartBounce.js"></script>
    <script type="application/javascript" src="lib/fartFlame.js"></script>
    <script type="application/javascript" src="lib/fartMine.js"></script>
    <script type="application/javascript" src="lib/bean.js"></script>
    <script type="application/javascript" src="lib/fartPack.js"></script>


    <script type="application/javascript" src="lib/fartCloud.js"></script>
    <script type="application/javascript" src="lib/game.js"></script>
    <script type="application/javascript" src="lib/gameView.js"></script>
    <script type="application/javascript" src="vendor/fireworks-bundle.js"></script>
    <script type="application/javascript" src="lib/exhaustAnimation.js"></script>

    <script type="application/javascript">
      (function () {
        // GameStateManager = new SFB.GameStateManager_Singleton();
        // ID.game_state_title = GameStateManager.add(new TitleMenuState());
        // ID.game_state_play = GameStateManager.add(new TitleMenuState());
        var canvasEl = document.getElementsByTagName("canvas")[0];
        canvasEl.width = SFB.Game.DIM_X;
        canvasEl.height = SFB.Game.DIM_Y;
        var ctx = canvasEl.getContext("2d");
        var that = this;
        var startGame = function() {
          var body = $("body");
          body[0].classList.add('white-body');
          if (that.game.spritesStillLoading > 0) {
            setTimeout(startGame(), 100)
          } else {
            new SFB.GameView(that.game, ctx).start();
          }
        };

        /* Store the players and their attrs in an object that will then be passed to the new game*/

        // PLAYERS = {};
        READYPLAYERS = [];

        /* EVENT LISTENERS */

        /* Get player number*/
        var addPlayers = function (event) {
          var target = $(event.currentTarget),
              players = target.data('id'),
              menu = document.getElementsByClassName('player-number-selection'),
              attrsMenu = document.getElementsByClassName('game-form');

              menu[0].classList.add('hidden');
              attrsMenu[0].classList.remove('hidden');

          PLAYERS = {};
          for(var i = 1; i <= 4; i ++) {
            var playerChoices = document.getElementsByClassName('player-' + i);

            for(var j = 0; j < playerChoices.length; j ++) {
              playerChoices[j].classList.remove('display-players');
            }
          }

          for(var i = 1; i <= players; i ++) {
            var playerChoices = document.getElementsByClassName('player-' + i);
            PLAYERS[i] = { attrs: {} };

            for(var j = 0; j < playerChoices.length; j ++) {
              playerChoices[j].classList.add('display-players');

            };
          };
        };

        var playerNumbers = document.getElementsByClassName('player-number');
        for(var i = 0; i < playerNumbers.length; i ++) {
          playerNumbers[i].addEventListener('click', addPlayers);
        }

        /* Change Player Number */
        var togglePlayers = function(options) {
          menu = document.getElementsByClassName('player-number-selection'),
          attrsMenu = document.getElementsByClassName('game-form');

          menu[0].classList.remove('hidden');
          attrsMenu[0].classList.add('hidden');

        };

        var changePlayerButton = document.getElementsByClassName('toggle-players');
        changePlayerButton[0].addEventListener('click', togglePlayers);

        /* Get player speed/health setting */
        var addPlayersType = function (event) {
          var target = $(event.currentTarget),
              player = target.data('id'),
              playerType = target.data('type');
          var playerTypes = $( "ul.player-" + player + "-types > li");

          for(var j = 0; j < playerTypes.length; j ++) {
            playerTypes[j].classList.remove('highlight-selection');
          }

          target[0].classList.add('highlight-selection');

          PLAYERS[player]['attrs']['playerType'] = playerType;

          if (Object.keys(PLAYERS[player]['attrs']).length === 2) {
            var readyButton = $( "article.player-" + player + "> button");
            readyButton[0].classList.remove('hide-button');
          }
        }

        var playersType = document.getElementsByClassName('player-type');
        for(var i = 0; i < playersType.length; i ++) {
          playersType[i].addEventListener('click', addPlayersType);
        }


        /* Get player special fart */
        var addPlayersFart = function (event) {
          var target = $(event.currentTarget),
              player = target.data('id'),
              playerFart = target.data('type');

          var playerFarts = $( "ul.player-" + player + "-farts > li");

          for(var j = 0; j < playerFarts.length; j ++) {
            playerFarts[j].classList.remove('highlight-selection');
          }


          target[0].classList.add('highlight-selection');

          PLAYERS[player]['attrs']['fart'] = playerFart;

          if (Object.keys(PLAYERS[player]['attrs']).length === 2) {
            var readyButton = $( "article.player-" + player + "> button");
            readyButton[0].classList.remove('hide-button');
          }
        }

        var playersFart = document.getElementsByClassName('player-fart');
        for(var i = 0; i < playersType.length; i ++) {
          playersFart[i].addEventListener('click', addPlayersFart);
        }

        /* Ready up */
        var readyPlayer = function() {
          var target = $(event.currentTarget),
              playerNumber = target.data('id'),
              player = document.getElementsByClassName('player-' + playerNumber)[0];

          player.classList.add('player-ready');
          READYPLAYERS.push(player);

          if (Object.keys(PLAYERS).length === READYPLAYERS.length) {
            var startButton = document.getElementsByName('start-game');
            startButton[0].classList.remove('hide-button');
            startButton[0].classList.add('start-game');

          }

        };

        var readyButton = document.getElementsByName('ready-up');
        for(var i = 0; i < readyButton.length; i ++) {
          readyButton[i].addEventListener('click', readyPlayer);
        }

        /* Start Game */
        // var readyGame = function(options) {
        //   var numPlayers = Object.keys(PLAYERS).length
        //   if (numPlayers === READYPLAYERS.length) {
        //     game = new SFB.Game(numPlayers);
        //     var menu = document.getElementsByClassName('game-menu')[0];
        //     menu.classList.add('hide-menu');
        //
        //     startGame();
        //     var body = $("body");
        //     body[0].classList.add('white-body');
        //
        //   }
        // };

        var readyGame = function(options) {
          var numPlayers = Object.keys(PLAYERS).length
            game = new SFB.Game(2);
            var menu = document.getElementsByClassName('game-menu')[0];
            menu.classList.add('hide-menu');

            startGame();
            var body = $("body");
            body[0].classList.add('white-body');

        };

        var startButton = document.getElementsByName('start-game');
        startButton[0].addEventListener('click', readyGame);


        PLAYERS = { 1: { attrs: {fart: "Bounce", playerType: "Normal" }}, 2: {attrs: {fart: "Bounce", playerType: "Normal" }}}

        var startButton = document.getElementById('start-game-test');
        startButton.addEventListener('click', readyGame);

        // game = new SFB.Game(PLAYERS);




      })();
    </script>
  </body>
</html>
